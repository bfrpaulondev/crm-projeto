# Render Blueprint for CRM Pipeline API
# This file configures automatic deployment on Render
# https://render.com/docs/blueprint-spec
#
# IMPORTANT: This configuration uses external services:
# - MongoDB Atlas (free tier)
# - Upstash Redis (free tier)
# Set the environment variables manually in Render Dashboard

services:
  # ===========================================================================
  # Web Service - API
  # ===========================================================================
  - type: web
    name: crm-api
    runtime: node
    region: oregon
    plan: free
    branch: main
    buildCommand: npm install && npm run build
    startCommand: npm start
    healthCheckPath: /health

    # Scaling for free tier
    numInstances: 1

    # Environment variables - SET THESE IN RENDER DASHBOARD
    envVars:
      - key: NODE_ENV
        value: production

      - key: PORT
        value: 10000

      # MongoDB Atlas - SET MANUALLY
      - key: MONGODB_URI
        sync: false

      - key: MONGODB_DB_NAME
        value: crm_api

      # Upstash Redis - SET MANUALLY
      - key: UPSTASH_REDIS_REST_URL
        sync: false

      - key: UPSTASH_REDIS_REST_TOKEN
        sync: false

      # JWT Secrets - GENERATE IN DASHBOARD
      - key: JWT_SECRET
        generateValue: true

      - key: JWT_REFRESH_SECRET
        generateValue: true

      - key: JWT_EXPIRES_IN
        value: 15m

      - key: JWT_REFRESH_EXPIRES_IN
        value: 7d

      # Security
      - key: RATE_LIMIT_WINDOW_MS
        value: 60000

      - key: RATE_LIMIT_MAX_REQUESTS
        value: 100

      - key: GRAPHQL_DEPTH_LIMIT
        value: 10

      - key: GRAPHQL_COMPLEXITY_LIMIT
        value: 1000

      # Disable introspection in production
      - key: INTROSPECTION_ENABLED
        value: false

      - key: PLAYGROUND_ENABLED
        value: false

      # Logging
      - key: LOG_LEVEL
        value: info

      - key: LOG_FORMAT
        value: json

      # CORS - SET YOUR FRONTEND URL
      - key: CORS_ORIGINS
        value: "*"

      # Storage (local for free tier)
      - key: STORAGE_TYPE
        value: local

# ===========================================================================
# SETUP INSTRUCTIONS:
#
# 1. Go to Render Dashboard > New > Blueprint
# 2. Connect your GitHub repository
# 3. Select this blueprint file
# 4. Set these environment variables manually:
#
#    MONGODB_URI:
#      mongodb+srv://bfrpaulondev_db_user:fejwbKAe6t6QlPYg@cluster0.cy4nwmv.mongodb.net/crm_api?retryWrites=true&w=majority
#
#    UPSTASH_REDIS_REST_URL:
#      https://summary-coyote-40506.upstash.io
#
#    UPSTASH_REDIS_REST_TOKEN:
#      AZ46AAIncDIxN2Y4NTVhMGFiZDk0OTQ0YTZmOGNmODUwNTE2OWYzOXAyNDA1MDY
#
# 5. CORS_ORIGINS: Set to your frontend URL (e.g., https://myapp.vercel.app)
#    Use "*" only for development/testing
#
# 6. Deploy!
# ===========================================================================
